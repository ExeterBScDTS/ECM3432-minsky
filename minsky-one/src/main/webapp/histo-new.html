<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="bootstrap/4.1.3/css/bootstrap.min.css">
    <!-- Custom styles for this template -->
    <link href="bootstrap/starter-template.css" rel="stylesheet">

    <title>Minsky One</title>
  </head>
  <body>
      <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
          <a class="navbar-brand" href="index.jsp">Minsky One</a>
          <div class="collapse navbar-collapse justify-content-end" id="navbarsExampleDefault">
            <form class="form-inline my-2 my-lg-0" method="get" action="authorised">
              <button class="btn btn-outline-success my-2 my-sm-0" type="submit"><%= user %></button>
            </form>
          </div>
        </nav>
        <main role="main" class="container">
            <div class="starter-template">
              <div style="width:980px;height:520px">
              <svg id="svg-hist" width="960" height="500"></svg>
              </div>
              <a href="authorised/status.jsp">Sensor status</a>
            </div>
        </main>

  <script>
  
  var rect=function(n,h,fill,max_height){
     var NS="http://www.w3.org/2000/svg";
     var SVGObj= document.createElementNS(NS,"rect");
     SVGObj.id="r_" + n;
     SVGObj.width.baseVal.value=17;
     SVGObj.height.baseVal.value=h;
     SVGObj.x.baseVal.value=1;
     SVGObj.style.fill=fill;
     SVGObj.setAttribute("transform","translate(" + (n * 18) + "," + (max_height - h) + ")");
     return SVGObj;
  }

  var setheight=function(n,h,fill,max_height){
     var SVGObj= document.getElementById("r_" + n);
     //SVGObj.width.baseVal.value=17;
     SVGObj.height.baseVal.value=h;
     //SVGObj.x.baseVal.value=1;
     SVGObj.style.fill=fill;
     SVGObj.setAttribute("transform","translate(" + (n * 18) + "," + (max_height - h) + ")");
  }

  var svg = document.getElementById('svg-hist');

  async function draw(num_bins,max_height){
    for(i=0; i<num_bins; i++){
       r1 = rect(i,1,"black",max_height); 
       svg.appendChild(r1);
    }
  }

  async function redraw(num_bins,max_height){
    const response = await fetch("histjson.jsp?bins=" + num_bins + "&height=" + max_height);
    const tir = await response.json();
    console.log(tir);
    for(i=0; i<tir.length; i++){
       console.log(i, tir[i]);
       setheight(i,tir[i],"black",max_height); 
    }
  }

  var num_bins = 50;
  var max_height = 460;
  draw(num_bins,max_height);
  redraw(num_bins,max_height);
  </script>      
  </body>
</html>